!function(e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():window.lazyload=e()}(function(){return lazyload=function(e){var t=this;for(var r in t.options=e||{},t.defaults={elements:".lazy",srcAttr:"data-src",mediaAttr:"data-media",clearSrc:!1,clearMedia:!1},t.elements=[],t.currentPixelRatio={},t.imageObserver=null,t.resizeHandler={handleEvent:t.windowResizeEvent,ctx:t},t.defaults)void 0===t.options[r]&&(t.options[r]=t.defaults[r]);t.init()},lazyload.prototype.init=function(){var e=this;e.createImgLazyObject(),e.getPxRatio(),e.createObserver(),e.startObserve(),window.addEventListener("resize",e.resizeHandler)},lazyload.prototype.createImgLazyObject=function(e){for(var t=this,r=t.options,a=e||document.querySelectorAll(r.elements),i=/\n|\t|\s{2,}/gm,n=/\(max\-width.*?\)|\(min\-width.*?\)/g,o=/\{.*?\}/g,s={imgSet:/image-set\((.*?)\)/,pxRatio:/[0-9.]+x$/,src:/.*(?=\s[0-9.]+x$)/,split:/\,\s|\,/},l=0;l<a.length;l++){var c,d,m=a[l].getAttribute(r.mediaAttr),v=a[l].getAttribute(r.srcAttr),u=void 0;if(a[l].lazyObject={src:t.imgSrcParse(v,s),media:{}},m){c=(m=m.replace(i,"")).match(n),u=m.match(o);var f=a[l].lazyObject.media;f.length=c.length;for(var g=0;g<f.length;g++)f[c[g]]=t.imgSrcParse(u[g].slice(1,-1),s);r.clearMedia&&a[l].removeAttribute("data-media")}r.clearSrc&&a[l].removeAttribute("data-src"),t.elements.push(a[l]),"function"==typeof window.CustomEvent&&(d=new CustomEvent("lazyinit"),a[l].dispatchEvent(d))}},lazyload.prototype.imgSrcParse=function(e,t){if(-1===e.search("image-set"))return e;for(var r={},a=e.replace(t.imgSet,"$1").split(t.split),i=0;i<a.length;i++){var n=a[i].match(t.pxRatio)[0],o=a[i].match(t.src)[0];r[n]=o}return r},lazyload.prototype.getPxRatio=function(){for(var e,t,r=+window.devicePixelRatio.toFixed(1),a=1;a<10;a++)if(1==a){if(r<=a){e=a+"x",t=a;break}}else if(a-1<r&&r<=a){e=a+"x",t=a;break}this.currentPixelRatio.str=e,this.currentPixelRatio.num=t},lazyload.prototype.createObserver=function(){var d=this;d.imageObserver=new IntersectionObserver(function(e){e.forEach(function(e){if(e.isIntersecting){var t,r=e.target,a=r.lazyObject,i=a.src,n=a.media;for(var o in n)"length"!=o&&matchMedia(o).matches&&(t=o);var s,l=t?n[t]:c?"":i,c=d.setImg(l);switch(r.tagName.toLowerCase()){case"img":r.src=c;break;case"header":case"section":case"footer":case"main":case"div":case"span":case"button":case"form":case"article":r.style.backgroundImage=c}"function"==typeof window.CustomEvent&&(s=new CustomEvent("lazyloaded"),r.dispatchEvent(s)),d.imageObserver.unobserve(r)}})})},lazyload.prototype.startObserve=function(e){for(var t=e||this.elements,r=0;r<t.length;r++)this.imageObserver.observe(t[r])},lazyload.prototype.setImg=function(e){var t="";if("string"==typeof e)t=e;else{var r=e[this.currentPixelRatio.str];if(!r)for(var a=1;a<10;a++){var i=e[this.currentPixelRatio.num-a+"x"];if(i){r=i;break}}t=r}return t},lazyload.prototype.windowResizeEvent=function(){var e=this.ctx||this,t=e.elements;e.getPxRatio();for(var r=0;r<t.length;r++)e.imageObserver.unobserve(t[r]),e.imageObserver.observe(t[r])},lazyload.prototype.destroy=function(){var e=this;window.removeEventListener("resize",e.resizeHandler),e.imageObserver.disconnect();for(var t=0;t<e.elements.length;t++)delete e.elements[t].lazyObject;e.elements=[],e.currentPixelRatio={},e.imageObserver=null},lazyload.prototype.refresh=function(){for(var e=this,t=document.querySelectorAll(e.options.elements),r=[],a=0;a<t.length;a++)t[a].lazyObject||r.push(t[a]);e.createImgLazyObject(r),e.startObserve(r),window.removeEventListener("resize",e.resizeHandler),window.addEventListener("resize",e.resizeHandler)},lazyload});